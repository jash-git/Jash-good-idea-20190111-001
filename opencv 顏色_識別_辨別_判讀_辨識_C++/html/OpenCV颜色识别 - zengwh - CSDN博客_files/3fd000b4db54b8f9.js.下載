var baseJs={time:8,ct:0,ut:0,firstClick:!0,mainParams:{mark:0,index:$(".play li").not("#btn").length,bool:!0,timer:null},init:function(){$("#change").html(baseJs.time);var e=this;e.protocol=window.location.protocol,e.showId=e._getQueryString("si"),e.containerID=e._getQueryString("containerID"),window.addEventListener("message",function(a){if(e.containerID!=a.data.containerID)return!1;"ADDataReady"==a.data.action&&(window.newAwards=a.data.data,window.clickPlugin=a.data.clickPlugin,window.gameData=a.data.pluginData,window.backupData=a.data.backupData,e.game=a.data.game,e.setGameData()),"askOpenDialog"==a.data.action&&window.parent.postMessage({action:"openMyAward",containerID:e.containerID,list:JSON.parse(window.localStorage.getItem("myAward"))},"*"),"closeDialogForCard"==a.data.action&&e.recoverAnimate()}),e.getInfos(),e.setRemainTimes(),e.openAward(),e.startGame()},startGame:function(){var e=$(".light p"),a=$(".play li").not("#btn"),t=$("#btn");localStorage.getItem("timesNineGridMin"+this.showId)<8&&(clearInterval(baseJs.mainParams.timer),baseJs.mainParams.timer=setInterval(function(){e.toggleClass("blin"),baseJs.mainParams.index++,baseJs.mainParams.index%=8,a.eq(baseJs.mainParams.index-1).removeClass("select"),a.eq(baseJs.mainParams.index).addClass("select"),baseJs.mainParams.mark++,baseJs.mainParams.mark%=8},500)),t.on("mousedown",function(e){baseJs.ct=(new Date).getTime()}).on("mouseup",function(){baseJs.ut=(new Date).getTime()}),t.click(function(){baseJs.mainParams.bool?(baseJs.mainParams.bool=!1,baseJs.times>0?baseJs.doStart():baseJs.clickBtn(!1)):!baseJs.mainParams.bool&&baseJs.times<=0&&baseJs.clickBtn(!1)})},doStart:function(){clearInterval(baseJs.mainParams.timer);for(var e=0;e<=8&&(baseJs.mainParams.mark+e)%8!=2;)e++;baseJs.mainParams.mark+=e,baseJs.mainParams.mark%=8,e+=24;for(var a=1;a<=e;a++)setTimeout(baseJs.doAnimate(),2*a*a);setTimeout(function(){setTimeout(function(){baseJs.mainParams.bool=!0,baseJs.clickBtn(!0)},1e3)},2*e*e)},doAnimate:function(){var e=$(".play li").not("#btn");return function(){$(".light p").toggleClass("blin"),baseJs.mainParams.index++,baseJs.mainParams.index%=8,e.eq(baseJs.mainParams.index-1).removeClass("select"),e.eq(baseJs.mainParams.index).addClass("select")}},recoverAnimate:function(){clearInterval(baseJs.mainParams.timer),baseJs.times>0&&this.startGame()},_getQueryString:function(e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(a);return null!=t?unescape(t[2]):null},getInfos:function(){var e=0,a=this,t=window.setInterval(function(){if(e++,window.newAwards){for(var i in newAwards.ads)newAwards.ads[i].impurl=newAwards.impurl,newAwards.ads[i].imptk.push(newAwards.impurl+newAwards.ads[i].imparg);window.clearInterval(t)}e>3&&!window.newAwards&&(a.askData(),e=0)},100)},setRemainTimes:function(){var e=this;try{var a=localStorage.getItem("timesNineGridMin"+e.showId)}catch(t){var a=e.getCookie("timesNineGridMin"+e.showId)}e.isDateChange()?(e.times=e.time,baseJs.syncRemains(e.times)):(e.times=e.time-a,baseJs.syncRemains(e.times)),$(".lastTimes").find("span").html(e.times)},openAward:function(){var e=this;$("#myAwards").on("click",function(){window.parent.postMessage({action:"openMyAward",containerID:e.containerID,list:JSON.parse(window.localStorage.getItem("myAward"))},"*")})},isDateChange:function(){var e="",a=this,t=new Date;if(!this.showId)return!1;t=""+t.getFullYear()+(t.getMonth()+1)+t.getDate();try{e=localStorage.getItem("rawDateNineGridMin"+a.showId)}catch(i){e=baseJs.getCookie("rawDateNineGridMin"+a.showId)}if(t!=e){try{localStorage.setItem("rawDateNineGridMin"+a.showId,t),localStorage.removeItem("statusNineGridMin"+a.showId),localStorage.removeItem("timesNineGridMin"+a.showId)}catch(i){baseJs.setCookie("rawDateNineGridMin"+a.showId,t,1),baseJs.delCookie("statusNineGridMin"+a.showId),baseJs.delCookie("timesNineGridMin"+a.showId)}return!0}return!1},askData:function(){window.parent.postMessage({action:"askADData",containerID:this.containerID,si:this.showId},"*")},openDialog:function(e){window.parent.postMessage({action:"openDialog",data:e,containerID:this.containerID,si:this.showId},"*")},clickBtn:function(e){if("undefined"==typeof newAwards)return!1;baseJs.firstClick&&(window.parent.postMessage({action:"clickGame",containerID:this.containerID},"*"),baseJs.firstClick=!1);var a=this;if(e){a.adClickPlugin(a.ct,a.ut,a.times),a.times-=1,a.times=a.times>0?a.times:0,$(".lastTimes").find("span").html(a.times);try{localStorage.setItem("timesNineGridMin"+a.showId,a.time-a.times)}catch(n){a.setCookie("timesNineGridMin"+a.showId,a.time-a.times)}try{if(!newAwards||!newAwards.ads){var t={type:"none"};return void a.openDialog(t)}if(0==newAwards.ads.length){var t={type:"none"};return void a.openDialog(t)}var i=newAwards.ads.shift(),t={item:i,title:i.desc,ticket:i.img,btntext:"\u7acb\u5373\u9886\u53d6",awardlink:i.curl,type:"bingo"};a.saveAward(i),a.openDialog(t)}catch(s){}}else{var t={type:"over"};a.openDialog(t)}},adClickPlugin:function(e,a,t){var i=this,n=window.clickPlugin;if(!window.clickPlugin)return!1;n=n.replace("__EVENT_TIME_START__",e).replace("__EVENT_TIME_END__",a).replace("__ACT_NUM__",t),baseJs.syncRemains(t),$.each(n.split(","),function(e,a){i.sendLog(a)})},sendLog:function(e){window.parent.postMessage({action:"sendLog",url:e,containerID:this.containerID,si:this.showId},"*")},syncRemains:function(e){e-=1,window.parent.postMessage({action:"syncRemains",containerID:this.containerID,times:e},"*")},saveAward:function(e){var a=JSON.parse(window.localStorage.getItem("myAward"))||[],t=!1;if(a.length>0)for(var i=0;i<a.length;i++){var n=(new Date).getTime();n-a[i].expireDate>=6048e5&&a.splice(i,1),a[i].desc==e.desc&&(t=!0)}t||(e.expireDate=(new Date).getTime(),a.push(e),window.localStorage.setItem("myAward",JSON.stringify(a)))},setGameData:function(){var e=JSON.parse(window.gameData.dj_interaction),a=e.skin.styleUrl?e.skin.styleUrl:"//cjhd.mediav.com/css/nineGrid/nineGrid_default.css";$("head").append('<link rel="stylesheet" href="'+a+'" type="text/css"/>'),$("#wrap").fadeIn(1e3),$(".page-loading").fadeOut(1e3)}};